rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Events collection - public read access, admin write access
    match /events/{eventId} {
      // Anyone can read active events (for public display)
      allow read: if resource.data.isActive == true;
      
      // Only authenticated admins can read all events (including inactive ones)
      allow read: if request.auth != null && 
                   request.auth.token.admin == true;
      
      // Only authenticated admins can create, update, or delete events
      allow create, update, delete: if request.auth != null && 
                                     request.auth.token.admin == true;
    }
    
    // Registrations collection - admin only access
    match /registrations/{registrationId} {
      // Only authenticated admins can read, create, update, or delete registrations
      allow read, write: if request.auth != null && 
                          request.auth.token.admin == true;
    }
    
    // Checkins collection - admin only access
    match /checkins/{checkinId} {
      // Only authenticated admins can read, create, update, or delete checkins
      allow read, write: if request.auth != null && 
                          request.auth.token.admin == true;
    }
    
    // Users collection - users can read their own data, admins can read all
    match /users/{userId} {
      // Users can read their own user document
      allow read: if request.auth != null && 
                   request.auth.uid == userId;
      
      // Admins can read all user documents
      allow read: if request.auth != null && 
                   request.auth.token.admin == true;
      
      // Users can create/update their own user document
      allow create, update: if request.auth != null && 
                             request.auth.uid == userId;
      
      // Admins can create/update any user document
      allow create, update: if request.auth != null && 
                             request.auth.token.admin == true;
    }
    
    // Default deny all other collections and operations
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
